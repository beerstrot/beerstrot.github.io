"use strict";(self.webpackChunkfoundation_zurb_template=self.webpackChunkfoundation_zurb_template||[]).push([[348],{348:function(e,t,n){n.r(t);var i=n(425);function o(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function r(e){(0,i.X9)("POST",{action:"days",data:"--"},(function(t){if(e){var n=e.split("_modifica")[0];!function(e,t){(0,i.X9)("POST",{action:"getReservation",data:e},(function(e){$("#ttitle").text("Modifica la Prenotazione"),$("<p/>").text('La prenotazione viene modificata solo quando clicchi il pulsante "Modifica Prenotazione"').insertAfter("#ttitle"),$("#prenota").text("Modifica Prenotazione");var n=e.booking,i=n.booking_customer,o=l(n),a=new Date(n.booked_for);t.setDate(a),$("#quantity").prop("disabled",!1).val(n.people),p(a,n.shift_id,n.people),$("#obs").val("--"===o.note?"":o.note),$("#seggiolini").val(o.seggiolini),$("#cani").prop("checked",o.cani),$("#name").val(i.first_name),$("#surname").val(i.last_name),$("#email").val(o.email),$("#telephone").val(o.telephone)}),(function(t){f("".concat(v,"\n        La ID della prenotazione è: ").concat(e,"."))}))}(n,d(n,t.dates))}else d(void 0,t.dates)}),(function(e){f(v)}))}$(document).ready((function(){var e=new URL(window.location.href).searchParams.get("id");if(e)return"notes"===e?s():"days"===e?c():"test"===e?(0,i.s)():e.endsWith("_modifica")?r(e):function(e){$("#new").hide(),$(".form").hide(),$("#prenotaDiv").show(),e.endsWith("_modificata")&&($("#ttitle").text("Prenotazione Modificata. Grazie"),$("#tlegend").text("Dettaglio prenotazione modificata"),e=e.split("_modifica")[0]),(0,i.X9)("POST",{action:"getReservation",data:e},(function(e){if(null===e.booking)return $("#yes").hide(),$("#no").hide(),b("Prenotazione non trovata.","Se non hai cancellato la prenotazione in precedenza, puoi scriverci una email a ".concat(h," o chiamarci al numero ").concat(m," per chiarimenti."));!function(e){if(!e||"error"in e)return t=$("#innerInfoDiv"),n=$("<fieldset/>").appendTo(t),$("<legend/>").text("Prenotazione non trovata").appendTo(n),$("<div/>").html("<p>Ti chiediamo gentilmente di contattarci.</p>").appendTo(n),$("<div/>").html(m).appendTo(n),$("<div/>").html(h).appendTo(n),void $("#buttonInfoDiv").hide();var t,n,o=e.booking_customer,a=l(e),r=k(e),c=r.date,s=r.date2,d=function(e,t){return $("#"+e).text(t)};d("name",o.first_name+" "+o.last_name),d("telephone",a.telephone),d("email",a.email),d("day",c.toLocaleString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),d("time1",y(c)),d("time2",y(s)),d("people",e.people),d("note",a.note);var u=a.seggiolini;d("segg",0==u?"No":u),d("dog",a.cani?"Sì":"No"),$("#modify").click((function(){var e=new URL(window.location.href).searchParams.get("id").split("_modificata")[0]+"_modifica";window.location.href=window.location.href.split("/").reverse().slice(1).reverse().join("/")+"/riserva-un-tavolo.html?id="+e})),$("#new").click((function(){window.location="https://www.beerstrot.it/riserva-un-tavolo.html"}));var p=e.id;$("#cancel").click((function(){b("Vuoi cancellare la prenotazione?","",(function(){$("#close-modal").click(),(0,i.X9)("POST",{action:"cancelReservation",data:p},(function(e){$("#ttitle").text("Prenotazione Cancellata. Grazie"),$("#tlegend").text("Dettaglio prenotazione cancellata "),$("#modify").hide(),$("#cancel").hide(),$("#new").show()}),(function(e){f("".concat(v,"\n              La ID della prenotazione è: ").concat(p,"."))}))}),(function(){$("#close-modal").click()}))}))}(e.booking)}),(function(t){f("".concat(messageErrorAlreadyCancelled,"\n        La ID della prenotazione è: ").concat(e,"."))}))}(e);r()}));var l=function(e){return JSON.parse(e.extra)};function c(e){$("#form").hide(),$("#notesTable").hide(),$("#notesDiv").show().css("margin-bottom","10%"),$("#innerNotesDiv").css("margin-top","0%"),$("#ttitle").text("Giorni di Chiusura"),$("#yes").text("Aggiungi/rimuovi"),$("#no").text("Non aggiungere/rimuovere"),(0,i.X9)("POST",{action:"days",data:e||"--"},(function(e){var t=e;$("#innerNotesDiv").html("<b>Giorni di chiusura:</b><br>"+t.dates.join("<br>")),$("#from2").flatpickr({minDate:"today",locale:"it",dateFormat:"d/M/Y",disableMobile:!0,onChange:function(e,t){e[0].setHours(12),function(e){var t=new Date(e).toLocaleString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"});b("<p>Sei sicuro di voler aggiungere o rimuovere <b>".concat(t,'</b> come giorno di chiusura?</p>\n    <p style="margin-bottom:0px;">Se lo aggiungi</b> ai giorni di chiusura:</p><ul><li>Tutte le prenotazione per  <b>').concat(t,"</b> saranno cancellate</li><li>I clienti prenotati <b>").concat(t,'</b> riceveranno l\'email di chiusura e cancellazione della prenotazione</li>\n    </ul><p style="margin-bottom:0px;">Se lo rimuovi dai giorni di chiusura:</p><ul><li>I clienti potranno prenotare per il giorno <b>').concat(t,"</b></li></ul>"),"",(function(){c(e.toISOString()),$("#close-modal").click()}),(function(){return $("#close-modal").click()}),!0)}(e[0])}})}),(function(e){f(v)}))}function s(e){$("#ttitle").text("Dashboard"),$("#loading").show(),$("#form").hide(),$("#notesDiv").show(),$("#innerNotesDiv").show(),$(".clearme").remove(),e=e||(new Date).toISOString(),(0,i.X9)("GET",{action:"notes",data:e},(function(t){var n=JSON.parse(t),o=new Date(n.date).toLocaleString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),a={};n.rooms.forEach((function(e){e.tables.forEach((function(e){a[e.id]=e.name}))}));var r=n.shifts.reduce((function(e,t){return e[t.id]=t,e[t.id].bookings=[],e[t.id].obookings=[],e}),{});r.anon={name:"anon",bookings:[]},$("#from2").flatpickr({locale:"it",dateFormat:"d/M/Y",disableMobile:!0,onChange:function(e,t){e[0].setHours(12),s(e[0].toISOString())}});var c,d=n.bookings,u=d.length;if(!u)return c="<b>".concat(o,"</b> non ci sono prenotazioni."),$("<p/>",{class:"clearme",css:{background:"",padding:""}}).html(c).appendTo("#notesDiv3"),void $("#innerNotesDiv").hide();var p=0,m=0,h=[],g=[];d.forEach((function(e,t){try{var n=l(e);if(!("seggiolini"in n))return;h.push(n),e.notes_=n,r[e.shift_id].obookings.push(e);var i=Number(n.seggiolini),o=Boolean(n.cani);p+=i,m+=o;var c=e.booking_customer;g.push({name:c.first_name+" "+c.last_name,people:e.people,table:e.tables.reduce((function(e,t){return e.push(a[t.table_id]),e}),[]).join(", "),telephone:n.telephone||"",email:n.email||"",time:new Date(e.booked_for).toLocaleString("it-it",{hour:"2-digit",minute:"2-digit"}),cani:o?"SI":"",seg:0==i?"":i,note:n.note})}catch(t){if(null===e.shift_id)return r.anon.bookings.push(e);r[e.shift_id].bookings.push(e)}})),g.sort((function(e,t){return e.time<t.time?-1:1})).forEach((function(e){var t=$("<tr/>",{class:"clearme"}).appendTo("#notesTableBody");$("<td/>",{css:{"text-align":"left"}}).html(e.name).appendTo(t),$("<td/>",{css:{"text-align":"right"}}).html(e.people).appendTo(t),$("<td/>",{css:{"text-align":"left"}}).html(e.table).appendTo(t),$("<td/>",{css:{"text-align":"left"}}).html(e.time).appendTo(t),$("<td/>",{css:{"text-align":"center"}}).html(e.cani).appendTo(t),$("<td/>",{css:{"text-align":"right"}}).html(e.seg).appendTo(t),$("<td/>",{css:{"text-align":"left","white-space":"normal","min-width":"200px"}}).html(e.note).appendTo(t),$("<td/>",{css:{"text-align":"left"}}).html(e.telephone).appendTo(t),$("<td/>",{css:{"text-align":"left"}}).html(e.email).appendTo(t)}));var y=0;for(var T in r){var w=r[T];if("anon"!==T){w.people_online=w.obookings.reduce((function(e,t){return e+t.people}),0),w.people_hand=w.bookings.reduce((function(e,t){return e+t.people}),0);var S=w.people_online+w.people_hand;if(y+=S,0!==S){var _=$("<tr/>",{class:"clearme"}).appendTo("#shiftsTableBody");$("<td/>",{css:{"text-align":"left"}}).html(w.name).appendTo(_),$("<td/>",{css:{"text-align":"right"}}).html(S).appendTo(_),$("<td/>",{css:{"text-align":"right"}}).html(w.people_online).appendTo(_),$("<td/>",{css:{"text-align":"right"}}).html(w.people_hand).appendTo(_)}}}r.anon.bookings.forEach((function(e){var t=k(e,!0),n=t.t,i=t.t2,o=$("<tr/>",{class:"clearme"}).appendTo("#anonTableBody");$("<td/>",{css:{"text-align":"left"}}).html(n).appendTo(o),$("<td/>",{css:{"text-align":"left"}}).html(i).appendTo(o),$("<td/>",{css:{"text-align":"right"}}).html(e.people).appendTo(o),$("<td/>",{css:{"text-align":"left"}}).html(e.tables.reduce((function(e,t){return e.push(a[t.table_id]),e}),[]).join(", ")).appendTo(o),y+=e.people}));var x='<ul class="no-bullet"><b>'.concat(o,"</b> ci sono:<li><b>").concat(u,"</b> prenotazioni (<b>").concat(h.length,"</b> online)</li><li><b>").concat(y,"</b> persone prenotate</li><li><b>").concat(m,"</b> prenotazioni con cani</li><li><b>").concat(p,"</b> seggioloni richiesti</li></ul>");$("<p/>",{class:"clearme",css:{padding:""}}).html(x).prependTo("#innerNotesDiv1"),h.length>0&&$("<button/>",{class:"clearme button small",css:{marginBottom:"3rem",marginTop:"0rem"}}).prependTo("#innerNotesDiv2").text("Invia email di promemoria a clienti").off("click").on("click",(function(){b("<p>Vuoi inviare email di promemoria della prenotazione ai clienti?</p>","giorno: "+o,(function(){return(0,i.X9)("POST",{action:"promemoria",data:e},(function(e){f("Email di promemoria inviate ai clienti")}),(function(e){f(v)}))}),(function(){return $("#close-modal").click()}),!0)}))}),(function(e){f(v)}))}function d(e,t){$("#infoDiv").hide(),$("#prenota").off("click").on("click",(function(){var t=n.selectedDates[0];t.setHours(12);var a={date:t.toISOString(),shiftId:$($(".aShift").filter((function(e,t){return"true"==$(t).attr("bselected")}))[0]).attr("bindex"),href:window.location.href,cani:$("#cani").is(":checked"),seggiolini:$("#seggiolini").val()};["name","surname","telephone","email","quantity","obs"].forEach((function(e){a[e]=$("#".concat(e)).val()})),function(e,t){return t.revalidate().then((function(){var t=[];return $("#from").val()||t.push("#from"),""===e.date&&t.push("#from1"),0==e.quantity&&t.push("#quantity1"),void 0===e.shiftId&&t.push("#shiftGrid1"),""===e.name&&t.push("#name1"),""===e.surname&&t.push("#surname1"),e.email.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||t.push("#email1"),""===e.telephone&&t.push("#telephone1"),$("#privacy").prop("checked")||t.push("#privacy3"),!(t.length>0&&(t.forEach((function(e){$(e.replace("1","")).attr("style","border: 1px solid red !important")})),1))}))}(a,o).then((function(t){t&&(e&&(a.oldID=e.split("_")[0]),(0,i.X9)("POST",{action:"mkReservation",data:a},(function(t){if("noPlacesLeft"===t.reservationID2)return f("In questo turno siamo al completo.");var n=window.location.href,i=(n="/"==n[n.length-1]?n:n.split("/").reverse().slice(1).reverse().join("/")+"/")+"consulta.html?id="+t.reservationID2;window.location.href=i+(e?"_modificata":"")}),(function(e){f(v)})))}))}));var n=$("#from").flatpickr({locale:"it",minDate:"today",dateFormat:"Y-m-d",disable:t||[],disableMobile:!0,onChange:function(e,t){$("#loading").show(),n.close(),e[0].setHours(12),p(e[0])}});n.set("dateFormat","d/M/Y");var o=new JustValidate("#form").addField("#name",[{rule:"required",errorMessage:"inserisci un nome"}]).addField("#surname",[{rule:"required",errorMessage:"inserisci un cognome"}]).addField("#telephone",[{rule:"required",errorMessage:"inserisci un numero di telefono"}]).addField("#from",[{rule:"required",errorMessage:"scegli una data"}]).addField("#quantity",[{rule:"required",errorMessage:"scegli il numero di persone"}]).addField("#privacy",[{rule:"required",errorMessage:"è necessario accettare l'Informativa sulla privacy"}]).addField("#shiftGridL",[{rule:"required",errorMessage:"seleziona un turno",validator:function(){return void 0!==$($(".aShift").filter((function(e,t){return"true"==$(t).attr("bselected")}))[0]).attr("bindex")}}]).addField("#email",[{rule:"required",errorMessage:"inserisci un'email"},{rule:"email",errorMessage:"L'email non è valida!"}]);return n}var u=["Su","Mo","Tu","We","Th","Fr","Sa"];function p(e,t,n){$(".bShift").remove();var a={day:e.getDate(),month:e.getMonth(),year:e.getYear()+1900};(0,i.X9)("POST",{action:"getShifts",data:a},(function(i){var r=function(e){return String(e).padStart(2,"0")},l="".concat(a.year,"-").concat(r(a.month+1),"-").concat(r(a.day)),c=u[e.getDay()],s=i.shifts.filter((function(e){return e.end_period>=l&&e.start_period<=l&&e.weekdays_period.includes(c)}));if(0===s.length)return f("<p>Nei mesi da Settembre a Maggio siamo aperti dal Giovedì alla Domenica.</p><p>Per richieste puoi inviarci una email a ".concat(h,"</p><p>Grazie</p>"));var d=function(e,t){var n=[],i=[];return e.forEach((function(e,t){var o=e.online_seats_limit-e.booked_seats_in_shift;if(o<=0)return i.push(t);for(var a in e.tables)e.tables[a]>o&&delete e.tables[a];if(e.table_sizes=Object.values(e.tables),0===e.table_sizes.length)return i.push(t);var r="aShift"+t;e.bid="#"+r;var l=$("<a/>",{id:r,class:"button aShift"}).text(e.name).appendTo($("<div/>",{class:"cell  bShift"}).appendTo("#shiftGrid"));l.bcolor=l.css("background-color"),l.attr("bindex",e.id),n.push(l)})),i.reverse().forEach((function(t){return e.splice(t,1)})),0===e.length&&f("In questa data siamo al completo."),n.forEach((function(e){e.click((function(){n.forEach((function(e){e.attr("bselected",!1),"none"!==e.css("pointer-events")&&e.css("background",e.bcolor)})),e.css("background","#18813B"),e.attr("bselected",!0)}))})),t&&$($(".aShift").filter((function(e,n){return $(n).attr("bindex")==t}))[0]).click(),e}(s,t);!function(e,t){var n=e.reduce((function(e,t){return Math.max.apply(Math,[e].concat(o(t.table_sizes)))}),0);$(".aquantity").remove(),o(Array(n).keys()).forEach((function(e){$("<option/>",{value:e+1,class:"aquantity"}).text(e+1).appendTo("#quantity")})),$("#quantity").prop("disabled",!1);var i={"pointer-events":"",cursor:"pointer",background:"#00687E"},a={"pointer-events":"none",cursor:"default",background:"rgba(0,104,126, 0.2)"};$("#quantity").off("input").on("input",(function(){var t=Number($(this).val());if(e.forEach((function(e,n){var o=0===e.table_sizes.filter((function(e){return e>=t})).length?a:i;$(e.bid).css(o).attr("bselected",!1)})),e.reduce((function(e,t){return e+("none"===$(t.bid).css("pointer-events"))}),0)===e.length)return f(g);$("#notification").hide()})),t&&$("#quantity").val(t)}(d,n)}),(function(e){return f(v)}))}function f(e){$("#modalLead").html(e),new Foundation.Reveal($("#myModal")).open()}var m='<a href="tel:+390718853384"><span itemprop="telephone"> 071&nbsp;8853384</span></a>',h='<a href="mailto:info@beerstrot.it?subject=Problema&nbsp;Prenotazione">info@beerstrot.it</a>',g="Per <b>13 o più persone</b>, vi preghiamo di contattarci tramite ".concat(h," o telefonarci al numero ").concat(m),v='<h2>Il Server non è raggiungibile</h2><p>Riprova fra qualche istante e assicurati di avere campo nel cellulare o internet funzionante da computer. Grazie.</p><ul class="no-bullet"><li>Se il problema persiste:</li><ul><li>Invia una email a '.concat(h,"</li><li>Chiamaci al numero ").concat(m,"</li></ul></li></ul>");function b(e,t,n,i,o){$("#yes").off("click").on("click",n),$("#no").off("click").on("click",i),$("#modalLead2").html(e),$("#modalText").html(t),new Foundation.Reveal($("#myModal"+(o?"2":""))).open()}var y=function(e){return e.toLocaleString("it-IT",{hour:"2-digit",minute:"2-digit"})};function k(e,t){var n=new Date(e.booked_for),i=new Date(n.getTime()+6e4*e.duration);return t?{t:y(n),t2:y(i)}:{date:n,date2:i}}}}]);