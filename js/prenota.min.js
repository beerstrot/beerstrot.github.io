$(document).ready(()=>{const e=new URL(window.location.href);var t=e.searchParams.get("id");if(t)return"notes"===t?showNotes():"test"===t?testeLambda():showReservation(t);makeInterface()});const url="https://6nw3zi6sbkph6dledhd4op3mvq0aaduw.lambda-url.eu-central-1.on.aws/";function mkCall(e,t,a,o,n,i){if(!["POST","GET"].includes(e))return console.log("this ajax method is not good: "+e);const s={crossDomain:!0,url:url,type:e,data:t,success:a,error:o,beforeSend:()=>$("#loading").show(),complete:()=>$("#loading").hide()};"POST"===e&&(s.data=JSON.stringify(s.data),"entry"===url.split("/").reverse()[0]&&(s.contentType="application/json; charset=utf-8")),$.ajax(s)}function testeLambdaPOST(){mkCall("POST",{action:"test",data:{hey:"man",nums:[5,6,7],jac:{33:44,l:["asd","ewq",66]}}},e=>console.log("POST success:",e),e=>console.log("POST error:",e))}function testeLambdaGET(){mkCall("GET",{action:"test",data:"a get arg"},e=>console.log("GET success:",e),e=>console.log("GET error:",e))}function testeLambda(){testeLambdaGET(),testeLambdaPOST()}function showNotes(e){$(".form").hide(),$("#infoDiv").hide(),$(".clearme").remove();$("#notesDiv").show();$("#innerNotesDiv").show(),mkCall("GET",{action:"notes",data:e||"2022-06-13T09:40:41.729Z"},e=>{window.rara=e;var e=JSON.parse(e),t=new Date(e.date).toLocaleString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"});jQuery("#from2").datetimepicker({startDate:new Date(e.date),format:"d/M/Y",timepicker:!1,inline:!0,onSelectDate:(e,t)=>{$("#loading").show(),showNotes(e.toISOString())}}).datetimepicker("show");const a=e.bookings;e=a.length;if(!e)return showNotesMessage(`nessuna prenotazione per <b>${t}</b>.`);let r=0,l=0;const c=[];a.forEach((e,t)=>{try{var a,o,n=JSON.parse(e.notes),i=(c.push(n),Boolean(n.seggiolini)),s=Boolean(n.cani);r+=i,l+=s,(i||s)&&(a=$("<tr/>",{class:"clearme",css:{background:t%2==0?"#fff":"#ddd"}}).appendTo("#notesTableBody"),o=e.booking_customer,$("<td/>").html(o.first_name+" "+o.last_name).appendTo(a),$("<td/>").html(n.telephone||"").appendTo(a),$("<td/>").html(n.email||"").appendTo(a),$("<td/>").html(new Date(e.booked_for).toLocaleString("it-IT",{hour:"2-digit",minute:"2-digit"})).appendTo(a),$("<td/>",{css:{background:s?"rgba(200, 255, 200, 0.5)":""}}).html(s?"X":"").appendTo(a),$("<td/>",{css:{background:i?"rgba(200, 200, 255, 0.5)":""}}).html(i?"X":"").appendTo(a),$("<td/>").html(n.note).appendTo(a))}catch(e){console.log(e,"not json notes!")}});e=`Ci sono <b>${e}</b> le prenotazioni per il giorno <b>${t}</b>, di cui <b>${l}</b> con cani e <b>${r}</b> con seggiolini.`;if(r+l===0)return showNotesMessage(e);$("<p/>",{class:"clearme",css:{padding:"2%"}}).html(e).prependTo("#innerNotesDiv")},e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
        Se il problema persiste, consigliamo di 
        <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>.`)})}function makeInterface(){$("#infoDiv").hide(),$("<button/>",{css:{"margin-left":"3%"},text:"Prenota",tabindex:7,click:()=>{if(!$("#from").val())return showMessage("selezionare una data");const e=$("#from").datetimepicker("getValue"),t=(e.setHours(12),{date:e.toISOString(),shiftId:$($(".bShift").filter((e,t)=>"true"==$(t).attr("bselected"))[0]).attr("bindex"),href:window.location.href,cani:$("#cani").is(":checked"),seggiolini:$("#seggiolini").is(":checked")});["name","surname","telephone","email","quantity","obs"].forEach(e=>{t[e]=$("#"+e).val()}),validateData(t)&&mkCall("POST",{action:"mkReservation",data:t},e=>{e=window.location.href+"?id="+e.reservationID2;window.location.href=e},e=>{showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
            Se il problema persiste, consigliamo di 
            <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
            per effettuare la prenotazione.`)})}}).appendTo("#contentDiv3");jQuery("#from").datetimepicker({disableDates:[],format:"d/M/Y",timepicker:!1,onSelectDate:(e,t)=>{$("#loading").show(),$("#from").chosen=!0,t.chosenn=!0,updateShifts(e)}})}function updateShifts(e){$(".bShift").remove();e={day:e.getDate(),month:e.getMonth(),year:e.getYear()+1900};let t=[];mkCall("POST",{action:"getShifts",data:e},e=>{t=mkShiftButtons(e.shifts)},e=>console.log(e,"the res")),$("#quantity").on("input",function(){const a=Number($(this).val());if(t.forEach((e,t)=>$("#bShift"+t).prop("disabled",0===e.table_sizes.filter(e=>e>=a).length)),t.reduce((e,t,a)=>e+$("#bShift"+a).prop("disabled"),0)===t.length)return showMessage(message10);$("#notification").hide()})}function mkShiftButtons(e){const n=[];return e.forEach((e,t)=>{var a=e.online_seats_limit-e.online_booked_seats;if(!(a<=0)){for(table in e.tables)e.tables[table]>a&&delete e.tables[table];e.table_sizes=Object.values(e.tables);const o=$("<button/>",{id:"bShift"+t,class:"success bShift",css:{margin:0,padding:"2%",width:"90%"}}).text(e.name).appendTo($("<li/>",{css:{margin:0,padding:0,"text-align":"center"}}).appendTo("#shiftGrid"));o.bcolor=o.css("background-color"),o.bindex=e.id,o.attr("bindex",e.id),o.attr("bindex2",t),n.push(o)}}),n.forEach(e=>{e.click(()=>{n.forEach(e=>{e.css("background",e.bcolor),e.selected=!1,e.attr("bselected",!1)}),e.css("background","darkgreen"),e.attr("bselected",!0)})}),$("#loading").hide(),$("#dateRow").show(),e}function showReservation(t){$(".form").hide(),mkCall("POST",{action:"getReservation",data:t},e=>{presentReservation(e.booking)},e=>{showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
        Se il problema persiste, consigliamo di 
        <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
        per consultare sulla prenotazione.<br>
        La ID della prenotazione è: ${t}.`)})}function presentReservation(a){if(!a||"error"in a)return bookingNotFound();var e=a.booking_customer,t=JSON.parse(a.notes);const o=new Date(a.booked_for),n=new Date(o.getTime()+6e4*a.duration);var i=$("#innerInfoDiv");const s=$("<fieldset/>").appendTo(i);$("<legend/>").text("Informazione della Prenotazione").appendTo(s);var i=(e,t)=>$("<div/>",{id:"i_"+t}).html(`<b>${e}</b>: `+a[t]).appendTo(s),r=(e,t)=>$("<div/>").html(`<b>${e}</b>: `+t).appendTo(s);r("Nome",e.first_name+" "+e.last_name),r("Telefono",t.telephone||"--"),r("Email",t.email||"--"),$("<br/>").appendTo(s),r("Quando",o.toLocaleString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})+"-"+n.toLocaleString("it-IT",{hour:"2-digit",minute:"2-digit"})),i("Quantità di ospiti","people"),r("Osservazioni",t.note),r("Cani",t.cani?"sì":"no"),r("Seggiolini",t.seggiolini?"sì":"no"),$("<br/>").appendTo(s),i("Status","status"),i("ID della prenotazione","id"),$("#modBtn").click(()=>{console.log("mod")}).hide();const l=a.id;$("#cancBtn").click(()=>{console.log("can"),mkCall("POST",{action:"cancelReservation",data:l},e=>{$("#i_status").html("<b>Status</b>: cancelled").css("background","pink")},e=>{showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
          Se il problema persiste, consigliamo di 
          <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
          per consultare sulla prenotazione.<br>
          La ID della prenotazione è: ${l}.`)})})}function validateEmail(e){return e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}function validateData(e){let t;if(""===e.name)t="inserire un nome.";else if(""===e.surname)t="inserire un cognome.";else if(""===e.telephone)t="inserire un telefono.";else if(validateEmail(e.email))if(""===e.date)t="scegli una data.";else if(void 0===e.shiftId)t="selezionare un periodo per la prenotatione.";else if(0==e.quantity)t="per quante persone è la prenotazione?";else{if(!(10<e.quantity))return $("#notification").hide(),!0;t=message10}else t="inserire un indirizzo e-mail.";showMessage(t)}function showMessage(e){$("#notification").html(e).show()}const telString='<p><a href="tel:+390718853384"><i class="fa fa-phone"></i><span itemprop="telephone"> 071 8853384</span></a></p>',messengerString='<p><a target="_blank" href="https://m.me/cavecchiabeerstrot"><i class="fab fa-facebook-messenger"></i>Chat messenger</a></p>',message10=`per <b>così tante persone</b>, vi preghiamo di contattarci:
${telString}
`+messengerString;function bookingNotFound(){var e=$("#innerInfoDiv"),e=$("<fieldset/>").appendTo(e);$("<legend/>").text("Prenotazione non trovata").appendTo(e),$("<div/>").html("<p>Vi chiediamo gentilmente di mettervi in contatto con noi.</p>").appendTo(e),$("<div/>").html(telString).appendTo(e),$("<div/>").html(messengerString).appendTo(e),$("#buttonInfoDiv").hide()}function showNotesMessage(e){$("<p/>",{class:"clearme",css:{background:"orange",padding:"2%"}}).html(e).appendTo("#notesDiv"),$("#innerNotesDiv").hide()}