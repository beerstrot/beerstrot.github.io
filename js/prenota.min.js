$(document).ready(()=>{const e=new URL(window.location.href);var o=e.searchParams.get("id");if(o)return showReservation(o);getShifts()});let tryCount=0;function getShifts(){$.ajax({url:"http://localhost:5001/shifts",type:"GET",crossDomain:!0,error:e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
        Se il problema persiste, consigliamo di 
        <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>.`)},beforeSend:function(){$("#loading").show()},success:e=>{console.log(e),window.rrr=e,makeInterface(JSON.parse(e)),$("#loading").hide()}})}function showReservation(o){$(".form").hide(),$.ajax({url:"http://localhost:5001/check",type:"GET",crossDomain:!0,data:{pid:o},dataType:"json",contentType:"application/json; charset=utf-8",error:e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
        Se il problema persiste, consigliamo di 
        <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
        per consultare sulla prenotazione.<br>
        La ID della prenotazione è: ${o}.`)},beforeSend:function(){$("#loading").show()},success:e=>{$("#loading").hide(),console.log(e.reservation),presentReservation(e.reservation)}})}function presentReservation(a){var e=$("#innerInfoDiv");const t=$("<fieldset/>").appendTo(e);$("<legend/>").text("Informazione della Prenotazione").appendTo(t);e=(e,o)=>$("<div/>",{id:"i_"+o}).html(`<b>${e}</b>: `+a[o]).appendTo(t);e("Nome","name"),e("Telefono","telephone"),e("Email","email"),e("Quando","date"),e("Quantità di ospiti","quantity"),e("Osservazioni","obs"),e("Status","status"),e("ID della prenotazione","reservationID"),$("#modBtn").click(()=>{console.log("mod")});const o=a.reservationID;$("#cancBtn").click(()=>{console.log("can"),$.ajax({url:"http://localhost:5001/cancel",type:"GET",crossDomain:!0,data:{pid:o},dataType:"json",contentType:"application/json; charset=utf-8",error:e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
          Se il problema persiste, consigliamo di 
          <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
          per consultare sulla prenotazione.<br>
          La ID della prenotazione è: ${o}.`)},beforeSend:function(){$("#loading").show()},success:e=>{$("#loading").hide(),$("#i_status").html("<b>Status</b>: cancelled").css("background","pink")}})})}function validateEmail(e){return e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}function validateData(e){let o;if(validateEmail(e.email))if(""===e.date)o="scegliere una data e un orario.";else if(""===e.name)o="inserire un nome.";else{if(""!==e.surname)return $("#notification").hide(),!0;o="inserire un cognome."}else o="inserire un indirizzo e-mail.";showMessage(o)}function showMessage(e){$("#notification").html(e).show()}function makeInterface(a){$("#infoDiv").hide(),$("<button/>",{css:{"margin-left":"3%"},text:"Prenotare",tabindex:7,click:()=>{const o={date:$("#from").datetimepicker("getValue").toISOString(),href:window.location.href};["name","cognome","telephone","email","quantity","obs"].forEach(e=>{o[e]=$("#"+e).val()});var e=i.filter(e=>e.selected);if(0===e.length)return showMessage("selezionare un periodo per la prenotation");o.shift=a[e[0].index],validateData(o)&&$.ajax({url:"http://localhost:5001/prenota",type:"POST",crossDomain:!0,data:JSON.stringify(o),dataType:"json",contentType:"application/json; charset=utf-8",error:e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
            Se il problema persiste, consigliamo di 
            <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
            per effettuare la prenotazione.`)},beforeSend:function(){$("#loading").show()},success:e=>{e=window.location.href+"?id="+e.reservationID;window.location.href=e}})}}).appendTo("#contentDiv3");jQuery("#from").datetimepicker({disableDates:[],step:15,format:"d/M/Y, H.i",defaultTime:"20",minTime:"19",maxTime:"23",onChangeDateTime:(e,o)=>{$("#from").chosen=!0,o.chosenn=!0,window.ddd={dp:e,input:o}}});const i=[];a.forEach((e,o)=>{var a=Math.floor(e.start_time/3600),t=Math.floor(e.start_time%3600/60),n=Math.floor(e.end_time/3600),e=Math.floor(e.end_time%3600/60);const r=$("<button/>",{class:"success bShift",css:{margin:0,padding:"2%",width:"90%"}}).text(a+`.${t} - ${n}.`+e).appendTo($("<li/>",{css:{margin:0,padding:0,"text-align":"center"}}).appendTo("#shiftGrid"));r.bcolor=r.css("background-color"),r.index=o,i.push(r)}),i.forEach(e=>{e.click(()=>{i.forEach(e=>{e.css("background",e.bcolor),e.selected=!1}),e.css("background","darkgreen"),e.selected=!0})})}function updateInterface(e){console.log(e,"avail")}function getAvailability(e){(e=e||new Date).setHours(0),e.setDate(e.getDate()-40),$.ajax({url:"http://localhost:5001/freeTables",type:"GET",crossDomain:!0,data:{date:e.toISOString()},dataType:"json",contentType:"application/json; charset=utf-8",error:e=>console.log(e,"the res"),success:e=>{window.rrr=e;const{rooms:o,bookings:a}=rrr;var t=o.map(e=>e.tables.map(e=>e.id)).flat();const n=a.map(e=>e.booked_for);n.sort(),window.aa={rooms:o,bookings:a,tableIds:t,bookedHours:n},updateInterface(e)}})}