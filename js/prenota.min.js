function showNotes(e){$(".form").hide(),$("#infoDiv").hide(),$(".clearme").remove();$("#notesDiv").show();$("#innerNotesDiv").show(),$.ajax({url:"http://localhost:5001/bookings",type:"GET",data:{date:e||"2022-06-13T09:40:41.729Z"},crossDomain:!0,error:e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
        Se il problema persiste, consigliamo di 
        <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>.`)},beforeSend:function(){$("#loading").show()},success:e=>{var e=JSON.parse(e),o=(console.log("the bookings:",e.bookings),console.log("the date:",e.date),new Date(e.date).toLocaleString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));jQuery("#from2").datetimepicker({startDate:new Date(e.date),format:"d/M/Y",minTime:"12:00",maxTime:"12:00",defaultTime:"12:00",allowTimes:["12:00"],timepicker:!1,onSelectDate:(e,o)=>{$("#loading").show(),updateShifts(e),showNotes((window.ddp=e).toISOString())},inline:!0}).datetimepicker("show");const t=e.bookings;$("#loading").hide(),window.bbb=e;e=t.length;if(!e)return showNotesMessage(`nessuna prenotazione per <b>${o}</b>.`);let r=0,l=0;const c=[];t.forEach((e,o)=>{try{var t,n,a=JSON.parse(e.notes),i=(c.push(a),Boolean(a.seggiolini)),s=Boolean(a.cani);r+=i,l+=s,(i||s)&&(t=$("<tr/>",{class:"clearme",css:{background:o%2==0?"#fff":"#ddd"}}).appendTo("#notesTableBody"),n=e.booking_customer,$("<td/>").html(n.first_name+" "+n.last_name).appendTo(t),$("<td/>").html(a.telephone||"").appendTo(t),$("<td/>").html(a.email||"").appendTo(t),$("<td/>").html(new Date(e.booked_for).toLocaleString("it-IT",{hour:"2-digit",minute:"2-digit"})).appendTo(t),$("<td/>",{css:{background:s?"rgba(200, 255, 200, 0.5)":""}}).html(s?"X":"").appendTo(t),$("<td/>",{css:{background:i?"rgba(200, 200, 255, 0.5)":""}}).html(i?"X":"").appendTo(t),$("<td/>").html(a.note).appendTo(t))}catch(e){console.log(e,"not json notes!")}}),window.ccc={nbookings:e,notes:c,nseggiolini:r,ncani:l};e=`Ci sono <b>${e}</b> le prenotazioni per il giorno <b>${o}</b>, di cui <b>${l}</b> con cani e <b>${r}</b> con seggiolini.`;if(r+l===0)return showNotesMessage(e);$("<p/>",{class:"clearme",css:{padding:"2%"}}).html(e).prependTo("#innerNotesDiv")}})}$(document).ready(()=>{const e=new URL(window.location.href);var o=e.searchParams.get("id");if(o)return"notes"==o?showNotes():showReservation(o);makeInterface()});let tryCount=0;function getShifts(){$.ajax({url:"http://localhost:5001/shifts",type:"GET",crossDomain:!0,error:e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
        Se il problema persiste, consigliamo di 
        <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>.`)},beforeSend:function(){$("#loading").show()},success:e=>{console.log("the shifts:",e),$("#loading").hide()}})}function showReservation(o){$(".form").hide(),console.log(o),$.ajax({url:"http://localhost:5001/check",type:"GET",crossDomain:!0,data:{pid:o},dataType:"json",contentType:"application/json; charset=utf-8",error:e=>{console.log(e,"ERROR"),$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
        Se il problema persiste, consigliamo di 
        <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
        per consultare sulla prenotazione.<br>
        La ID della prenotazione è: ${o}.`)},beforeSend:function(){$("#loading").show()},success:e=>{$("#loading").hide(),console.log(e,"SUCCESS"),window.bbb=e.booking,presentReservation(e.booking)}})}function presentReservation(t){if(!t||"error"in t)return bookingNotFound();var e=t.booking_customer,o=JSON.parse(t.notes);const n=new Date(t.booked_for),a=new Date(n.getTime()+6e4*t.duration);var i=$("#innerInfoDiv");const s=$("<fieldset/>").appendTo(i);$("<legend/>").text("Informazione della Prenotazione").appendTo(s);var i=(e,o)=>$("<div/>",{id:"i_"+o}).html(`<b>${e}</b>: `+t[o]).appendTo(s),r=(e,o)=>$("<div/>").html(`<b>${e}</b>: `+o).appendTo(s);r("Nome",e.first_name+" "+e.last_name),r("Telefono",o.telephone||"--"),r("Email",o.email||"--"),$("<br/>").appendTo(s),r("Quando",n.toLocaleString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})+"-"+a.toLocaleString("it-IT",{hour:"2-digit",minute:"2-digit"})),i("Quantità di ospiti","people"),r("Osservazioni",o.note),r("Cani",o.cani?"sì":"no"),r("Seggiolini",o.seggiolini?"sì":"no"),$("<br/>").appendTo(s),i("Status","status"),i("ID della prenotazione","id"),$("#modBtn").click(()=>{console.log("mod")}).hide();const l=t.id;$("#cancBtn").click(()=>{console.log("can"),$.ajax({url:"http://localhost:5001/cancel",type:"GET",crossDomain:!0,data:{pid:l},dataType:"json",contentType:"application/json; charset=utf-8",error:e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
          Se il problema persiste, consigliamo di 
          <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
          per consultare sulla prenotazione.<br>
          La ID della prenotazione è: ${l}.`)},beforeSend:function(){$("#loading").show()},success:e=>{$("#loading").hide(),$("#i_status").html("<b>Status</b>: cancelled").css("background","pink")}})})}function validateEmail(e){return e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}function validateData(e){let o;if(validateEmail(e.email))if(""===e.date)o="scegliere una data e un orario.";else if(void 0===e.shiftId)o="selezionare un periodo per la prenotatione.";else if(""===e.name)o="inserire un nome.";else if(""===e.surname)o="inserire un cognome.";else if(0==e.quantity)o="per quante persone è la prenotazione?";else{if(!(10<e.quantity))return $("#notification").hide(),!0;o=message10}else o="inserire un indirizzo e-mail.";showMessage(o)}function showMessage(e){$("#notification").html(e).show()}function makeInterface(){$("#infoDiv").hide(),$("<button/>",{css:{"margin-left":"3%"},text:"Prenotare",tabindex:7,click:()=>{if(!$("#from").val())return showMessage("selezionare una data");const e=$("#from").datetimepicker("getValue"),o=(e.setHours(12),{date:e.toISOString(),shiftId:$($(".bShift").filter((e,o)=>"true"==$(o).attr("bselected"))[0]).attr("bindex"),href:window.location.href,cani:$("#cani").is(":checked"),seggiolini:$("#seggiolini").is(":checked")});["name","surname","telephone","email","quantity","obs"].forEach(e=>{o[e]=$("#"+e).val()}),validateData(o)&&(console.log("data sent:",o),$.ajax({url:"http://localhost:5001/prenota",type:"POST",crossDomain:!0,data:JSON.stringify(o),dataType:"json",contentType:"application/json; charset=utf-8",error:e=>{$("#loading").hide(),showMessage(`Si prega di riprovare perché abbiamo riscontrato un errore.
            Se il problema persiste, consigliamo di 
            <a href="https://www.messenger.com/t/397632563730269/" target="_blank">entrare in chat</a>
            per effettuare la prenotazione.`)},beforeSend:function(){$("#loading").show()},success:e=>{e=window.location.href+"?id="+e.reservationID2;window.location.href=e}}))}}).appendTo("#contentDiv3");jQuery("#from").datetimepicker({disableDates:[],format:"d/M/Y",minTime:"12:00",maxTime:"12:00",defaultTime:"12:00",allowTimes:["12:00"],timepicker:!1,onSelectDate:(e,o)=>{$("#loading").show(),window.ddd={dp:e,input:o},console.log("dp select"),$("#from").chosen=!0,o.chosenn=!0,updateShifts(e)}})}function updateInterface(e){console.log(e,"avail")}function getAvailability(e){(e=e||new Date).setHours(0),e.setDate(e.getDate()-40),$.ajax({url:"http://localhost:5001/freeTables",type:"GET",crossDomain:!0,data:{date:e.toISOString()},dataType:"json",contentType:"application/json; charset=utf-8",error:e=>console.log(e,"the res"),success:e=>{window.rrr=e;const{rooms:o,bookings:t}=rrr;var n=o.map(e=>e.tables.map(e=>e.id)).flat();const a=t.map(e=>e.booked_for);a.sort(),window.aa={rooms:o,bookings:t,tableIds:n,bookedHours:a},updateInterface(e)}})}const weekdays={Su:0,Mo:1,Tu:2,We:3,Th:4,Fr:5,Sa:6};function updateShifts(e){$(".bShift").remove();e={day:e.getDate(),month:e.getMonth(),year:e.getYear()+1900};let o=[];$.ajax({url:"http://localhost:5001/shiftsAvailable",type:"GET",crossDomain:!0,data:e,dataType:"json",contentType:"application/json; charset=utf-8",error:e=>console.log(e,"the res"),success:e=>{window.shifts_available=e,o=mkShiftButtons(e.shifts)}}),$("#quantity").on("input",function(){const t=Number($(this).val());if(console.log(t,o),o.forEach((e,o)=>{$("#bShift"+o).prop("disabled",0===e.table_sizes.filter(e=>e>=t).length)}),10<t)return showMessage(message10);$("#notification").hide()})}function mkShiftButtons(e){const a=[];return e.forEach((e,o)=>{var t=e.online_seats_limit-e.online_booked_seats;if(!(t<=0)){for(table in e.tables)console.log(table),e.tables[table]>t&&delete e.tables[table];e.table_sizes=Object.values(e.tables);const n=$("<button/>",{id:"bShift"+o,class:"success bShift",css:{margin:0,padding:"2%",width:"90%"}}).text(e.name).appendTo($("<li/>",{css:{margin:0,padding:0,"text-align":"center"}}).appendTo("#shiftGrid"));n.bcolor=n.css("background-color"),n.bindex=e.id,n.attr("bindex",e.id),n.attr("bindex2",o),a.push(n)}}),a.forEach(e=>{e.click(()=>{a.forEach(e=>{e.css("background",e.bcolor),e.selected=!1,e.attr("bselected",!1)}),e.css("background","darkgreen"),e.attr("bselected",!0)})}),$("#loading").hide(),$("#dateRow").show(),e}const telString='<p><a href="tel:+390718853384"><i class="fa fa-phone"></i><span itemprop="telephone"> 071 8853384</span></a></p>',messengerString='<p><a target="_blank" href="https://m.me/cavecchiabeerstrot"><i class="fab fa-facebook-messenger"></i>Chat messenger</a></p>',message10=`per prenotazioni di <b>oltre 10 persone</b>, vi preghiamo di contattarci:
${telString}
`+messengerString;function bookingNotFound(){var e=$("#innerInfoDiv"),e=$("<fieldset/>").appendTo(e);$("<legend/>").text("Prenotazione non trovata").appendTo(e),$("<div/>").html("<p>Vi chiediamo gentilmente di mettervi in contatto con noi.</p>").appendTo(e),$("<div/>").html(telString).appendTo(e),$("<div/>").html(messengerString).appendTo(e),$("#buttonInfoDiv").hide()}function showNotesMessage(e){$("<p/>",{class:"clearme",css:{background:"orange",padding:"2%"}}).html(e).appendTo("#notesDiv"),$("#innerNotesDiv").hide()}